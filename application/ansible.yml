---
- name: Deploy Application
  hosts: local

  pre_tasks:
    - name: Get App PID (If Already Running)
      ansible.builtin.shell: ps cx | grep app | awk '{print $1}'
      register: pid

    - name: Kill App (If Already Running)
      ansible.builtin.shell: "kill -9 {{ pid.stdout }}"
      when: pid.rc

  tasks:
    - name: Get Latest
      ansible.builtin.shell: cd ../ && git pull

    - name: Compile Application
      make:
        chdir: .
        target: bin/app
      register: compiler

    - name: Execute Application
      ansible.builtin.shell: "./bin/app &"
      when: not compiler.failed
...
